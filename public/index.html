<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Sense360 API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="javascripts/GA.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["Swift"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="Swift">Swift</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a id="sign" href='https://docs.google.com/a/sense360.com/forms/d/1EJwLR8GC0JAqeH5F1FIWKVZJ527qdQZ7GiWirS0mDxc/viewform?usp=send_form'>Sign Up for a Developer Key!</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Sense360 allows you to quickly build functions around actions that your users take in the physical world. You can build triggers based on where a user is, what they are doing, or what is happening around them. <strong>You can do all this in the background, even if your app is closed.</strong> Adding these real-world triggers to your app can take months if you try to achieve high accuracy, low battery drain, and maximum user privacy. We make the process quick and painless.</p>

<p>Eventually, we aim to have a trigger for any action a user can take, whether it be &ldquo;running&rdquo;, &ldquo;driving&rdquo;, &ldquo;waking up&rdquo;, &ldquo;eating&rdquo;, &ldquo;watching tv&rdquo;, &ldquo;playing basketball&rdquo;, &ldquo;watching basketball&rdquo;, etc.</p>

<p><strong>Sign up for a developer key</strong> by clicking the green link on the left. </p>

<p>Have fun creating!</p>

<h1 id="api-components">API Components</h1>

<p>The following are the main components of building with Sense360</p>

<p><a href="#triggers">Triggers</a>: The real-world event that you want to listen for (can be a place, action, or contextual element). Example triggers are “has arrived at airport”, “has exited work”, or “is 100 miles from home”</p>

<p><a href="#recipes">Recipes</a>:  A collection of elements (including the Trigger) that defines <strong>when</strong> you want to listen for the trigger, and <strong>what</strong> you want to happen when the trigger is fired. Recipes gives you the flexibility to do whatever you want upon a Trigger event and are constructed of the following:</p>

<ul>
<li><p><strong>Unique Id (required)</strong>: A unique identifier amongst all recipes within your app. Examples: &ldquo;ID-1234&rdquo; or &ldquo;EnteredWork&rdquo;.</p></li>
<li><p><strong>Delegate (required)</strong>: The method that is called when the trigger is fired.</p></li>
<li><p><strong>Trigger (required)</strong>: The real-world event that you want to listen for.</p></li>
<li><p><strong>Window (optional)</strong>: The period of time during which you want to listen for the trigger. Examples: 9am to 12pm and 4pm - 11pm.</p></li>
<li><p><strong>Cooldown (optional)</strong>: The amount of time to wait before the same trigger can fire again. Examples: 8 hours, 1 week.</p></li>
</ul>

<h1 id="quick-start">Quick Start</h1>

<p>[Link to Quick Start]</p>

<h1 id="triggers">Triggers</h1>

<p>Triggers define the conditions under which your app should be notified. There are 3 types of places that you can be notified about. 3 types of Triggers are supported:</p>

<ul>
<li><a href="#place-of-interest-(poi)">Place of Interest (POI)</a> - Examples are: Restaurant, Shopping Mall, etc.</li>
<li><a href="#personal-place">Personal Place</a> - Examples are: Home/Work.</li>
<li><a href="#custom-geofence">Custom Geofence</a> - These can be any latitude/longitude point with a radius.</li>
</ul>

<aside class="notice"> IMPORTANT: A trigger on its own does nothing. You must build your triggers, and then add it to a Recipe in order to utilize the trigger. 
</aside>

<h2 id="place-of-interest-(poi)">Place of Interest (POI)</h2>

<p>Gives you the ability to be notified when a user enters or exits a particular POI type.</p>
<pre><code class="highlight swift"><span class="c1">// Will notify you when the user enters an Airport
</span><span class="k">let</span> <span class="nv">airportTrigger</span> <span class="o">=</span> <span class="kt">Trigger</span><span class="o">.</span><span class="nf">whenEnters</span><span class="p">(</span><span class="o">.</span><span class="kt">Airport</span><span class="p">)</span><span class="o">.</span><span class="n">trigger</span><span class="o">!</span>
</code></pre>

<p>Supported POI types:</p>

<table><thead>
<tr>
<th>Category</th>
<th>Transitions</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>Airport</td>
<td>.whenEnters(.Airport)</td>
<td>.whenExits(.Airport)</td>
</tr>
<tr>
<td>Bar</td>
<td>.whenEnters(.Bar)</td>
<td>.whenExits(.Bar)</td>
</tr>
<tr>
<td>Restaurant</td>
<td>.whenEnters(.Restaurant)</td>
<td>.whenExits(.Restaurant)</td>
</tr>
<tr>
<td>Mall</td>
<td>.whenEnters(.Mall)</td>
<td>.whenExits(.Mall)</td>
</tr>
<tr>
<td>Cafe</td>
<td>.whenEnters(.Cafe)</td>
<td>.whenExits(.Cafe)</td>
</tr>
<tr>
<td>Gym</td>
<td>.whenEnters(.Gym)</td>
<td>.whenExits(.Gym)</td>
</tr>
</tbody></table>

<h3 id="caveats">Caveats</h3>

<ul>
<li>Each trigger can only detect a single POI type.</li>
<li>The sdk will not trigger immediately on entrance or exit because it needs to be sure of the action.</li>
</ul>

<h2 id="personal-place">Personal Place</h2>

<p>Gives you the ability to be notified when a user enters or exits their home or work. You can also be notified if the user is far awar from their home or work.</p>
<pre><code class="highlight swift"><span class="k">let</span> <span class="nv">homeTrigger</span> <span class="o">=</span> <span class="kt">Trigger</span><span class="o">.</span><span class="nf">whenEnters</span><span class="p">(</span><span class="o">.</span><span class="kt">Home</span><span class="p">)</span><span class="o">.</span><span class="n">trigger</span><span class="o">!</span>
</code></pre>

<p>The currently supported personalized location categories are:</p>

<table><thead>
<tr>
<th>Category</th>
<th>Transitions</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>Home</td>
<td>.whenEnters(.Home)</td>
<td>.whenExits(.Home)</td>
</tr>
<tr>
<td>Work</td>
<td>.whenEnters(.Work)</td>
<td>.whenExits(.Work)</td>
</tr>
</tbody></table>

<h3 id="caveats">Caveats</h3>

<ul>
<li>The SDK takes roughly a week to determine a user&rsquo;s home or work. After the SDK identifies the users home or work, it can then start detecting it.</li>
<li>The SDK will continually try to update the user&rsquo;s home every few days.</li>
<li>Due to the sensitivity of this data, neither developers nor us will ever see the raw data or store a users home or office location. The computation happens on the device itself and stays there to ensure your users privacy.</li>
</ul>

<h2 id="custom-geofence">Custom Geofence</h2>

<p>A custom geofence allows you specify a region to monitor for entrance and exit.</p>
<pre><code class="highlight swift"><span class="k">let</span> <span class="nv">hq</span> <span class="o">=</span> <span class="kt">CustomGeofence</span><span class="p">(</span><span class="nv">latitude</span><span class="p">:</span> <span class="mf">37.124</span><span class="p">,</span> <span class="nv">longitude</span><span class="p">:</span> <span class="o">-</span><span class="mf">127.456</span><span class="p">,</span> <span class="nv">radiusMeters</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nv">customIdentifier</span><span class="p">:</span> <span class="s">"Sense 360 Headquarters"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">lunchSpot</span> <span class="o">=</span> <span class="kt">CustomGeofence</span><span class="p">(</span><span class="nv">latitude</span><span class="p">:</span> <span class="mf">37.124</span><span class="p">,</span> <span class="nv">longitude</span><span class="p">:</span> <span class="o">-</span><span class="mf">127.456</span><span class="p">,</span> <span class="nv">radiusMeters</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="nv">customIdentifier</span><span class="p">:</span> <span class="s">"A&amp;B Bar and Grill"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">trigger</span> <span class="o">=</span> <span class="kt">Trigger</span><span class="o">.</span><span class="nf">whenEnters</span><span class="p">([</span><span class="n">hq</span><span class="p">,</span> <span class="n">lunchSpot</span><span class="p">])</span><span class="o">.</span><span class="n">trigger</span><span class="o">!</span>
</code></pre>

<p>All custom geofence triggers must specify the following parameters</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>location</td>
<td>Location</td>
<td>true</td>
<td>location</td>
</tr>
<tr>
<td>radiusMeters</td>
<td>Int</td>
<td>true</td>
<td>radius of geofence</td>
</tr>
<tr>
<td>customIdentifier</td>
<td>String</td>
<td>true</td>
<td>unique name for place</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Type</th>
<th>Transitions</th>
<th></th>
</tr>
</thead><tbody>
<tr>
<td>CustomGeofence</td>
<td>.whenEnters()</td>
<td>.whenExits()</td>
</tr>
</tbody></table>

<h3 id="caveats">Caveats</h3>

<ul>
<li>You can specify at most 1000 geofences to monitor</li>
<li>Geofences must have a radius of at least 20m</li>
</ul>

<h2 id="trigger-build-result-definition:">Trigger Build Result Definition:</h2>
<pre><code class="highlight swift"><span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="kt">Trigger</span><span class="o">.</span><span class="nf">whenEnters</span><span class="p">(</span><span class="o">.</span><span class="kt">Home</span><span class="p">)</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">homeTrigger</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">trigger</span> <span class="p">{</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"It worked!"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">error</span> <span class="k">in</span> <span class="n">result</span><span class="o">.</span><span class="n">errors</span> <span class="p">{</span>
        <span class="kt">NSLog</span><span class="p">(</span><span class="s">"Error: </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">message</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The Trigger class returns either the trigger or a list of errors. The properties are:</p>

<table><thead>
<tr>
<th>TriggerBuildResult Type</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>SenseTrigger?</td>
<td>trigger</td>
<td>The final trigger when there are no errors.</td>
</tr>
<tr>
<td>[TriggerError]</td>
<td>errors</td>
<td>The errors that took place during the build.</td>
</tr>
</tbody></table>

<h1 id="recipes">Recipes</h1>

<p>The Recipe is the container that encases your trigger, and various other settings.  Recipes are registered globally within your application with a call to the <a href="#sensesdk">SenseSdk</a>.  Below are the inputs that make up a Recipe:</p>
<pre><code class="highlight swift"><span class="k">let</span> <span class="nv">recipe</span> <span class="o">=</span> <span class="kt">Recipe</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"My Recipe"</span><span class="p">,</span> <span class="nv">trigger</span><span class="p">:</span> <span class="n">someTrigger</span><span class="p">)</span>
</code></pre>

<table><thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>uniqueId (String)</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td><a href="#triggers">trigger</a></td>
<td>true</td>
<td></td>
</tr>
<tr>
<td><a href="#window">window</a></td>
<td>false</td>
<td>0-23 hours</td>
</tr>
<tr>
<td><a href="#cooldown">cool down</a></td>
<td>false</td>
<td>1 minute</td>
</tr>
</tbody></table>

<h2 id="window">Window</h2>

<p>A window specifies which hours of the day a trigger is allowed to fire.</p>
<pre><code class="highlight swift"><span class="c1">// This will only allow a trigger to fire between the hours of 5pm and 10pm (in the users local time)
</span><span class="k">let</span> <span class="nv">recipe</span> <span class="o">=</span> <span class="kt">Recipe</span><span class="p">(</span>
  <span class="nv">name</span><span class="p">:</span> <span class="s">"My Recipe"</span><span class="p">,</span> 
  <span class="nv">trigger</span><span class="p">:</span> <span class="n">someTrigger</span><span class="p">,</span>
  <span class="nv">window</span><span class="p">:</span> <span class="kt">TimeWindow</span><span class="p">(</span><span class="nv">fromHour</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="nv">toHour</span><span class="p">:</span> <span class="mi">22</span><span class="p">))</span>
</code></pre>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Range</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>fromHour</td>
<td>Int</td>
<td>0-23</td>
<td>true</td>
<td>Window start time (user&rsquo;s local time)</td>
</tr>
<tr>
<td>toHour</td>
<td>Int</td>
<td>0-23</td>
<td>true</td>
<td>Window end time (user&rsquo;s local time)</td>
</tr>
</tbody></table>

<h3 id="caveats">Caveats</h3>

<ul>
<li>The transition must occur between the times specified. For example, if a user enters at 5am, and the window was set for 6am - 7am, the trigger WILL NOT fire, even if the user is still within the specified geofence at 6am.</li>
</ul>

<h2 id="cooldown">Cooldown</h2>

<p>The amount of time after a trigger fires, to wait before the same trigger can fire again.</p>
<pre><code class="highlight swift"><span class="c1">// Wait 2 days after the trigger fires
</span><span class="k">let</span> <span class="nv">recipe</span> <span class="o">=</span> <span class="kt">Recipe</span><span class="p">(</span>
  <span class="nv">name</span><span class="p">:</span> <span class="s">"My Recipe"</span><span class="p">,</span> 
  <span class="nv">trigger</span><span class="p">:</span> <span class="n">someTrigger</span><span class="p">,</span> 
  <span class="nv">cooldown</span><span class="p">:</span> <span class="kt">Cooldown</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="nv">oncePer</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">frequency</span><span class="p">:</span> <span class="o">.</span><span class="kt">Days</span><span class="p">)</span><span class="o">!</span>
</code></pre>

<table><thead>
<tr>
<th>Unit</th>
<th>Signature</th>
</tr>
</thead><tbody>
<tr>
<td>Minutes</td>
<td>Cooldown.create(oncePer: 1, frequency: .Minutes)!</td>
</tr>
<tr>
<td>Hours</td>
<td>Cooldown.create(oncePer: 1, frequency: .Hours)!</td>
</tr>
<tr>
<td>Days</td>
<td>Cooldown.create(oncePer: 1, frequency: .Days)!</td>
</tr>
</tbody></table>

<h2 id="compound-triggers">Compound Triggers</h2>
<pre><code class="highlight swift"><span class="k">let</span> <span class="nv">trigger</span> <span class="o">=</span> <span class="kt">CompoundTriggerBuilder</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">with</span><span class="p">(</span><span class="n">airportTrigger</span><span class="p">,</span> <span class="nv">and</span><span class="p">:</span> <span class="n">homeTrigger</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">build</span><span class="p">()</span>
</code></pre>

<p>You have the ability to combine triggers to create a compound trigger:</p>

<p>In two of the examples above, both airportTrigger and homeTrigger were defined.  By then ANDing the two, you get a trigger that listens for when a user is at an airport AND 100+ kilometers from home (i.e. traveling):</p>

<h1 id="sensesdk">SenseSdk</h1>

<p>The SenseSdk is the main entry point into the Sdk. It allows you to register and unregister recipes.</p>
<pre><code class="highlight swift"><span class="c1">// Registering a recipe and delegate
</span><span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="kt">SenseSdk</span><span class="o">.</span><span class="nf">register</span><span class="p">(</span><span class="nv">recipe</span><span class="p">:</span> <span class="n">myRecipe</span><span class="p">,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="n">myDelegate</span><span class="p">)</span>
<span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">successful</span> <span class="p">{</span>
  <span class="kt">NSLog</span><span class="p">(</span><span class="s">"recipe registration successful"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">let</span> <span class="nv">errors</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">errors</span> <span class="p">{</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"Registration unsucessful, see errors below"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">error</span> <span class="k">in</span> <span class="n">errors</span> <span class="p">{</span>
      <span class="kt">NSLog</span><span class="p">(</span><span class="s">"message: </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<table><thead>
<tr>
<th>Function</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>register</td>
<td>Recipe, TriggerFiredDelegate</td>
<td>Starts the recipe and registers the delegate to be called when the trigger fires.</td>
</tr>
<tr>
<td>unregister</td>
<td>Recipe</td>
<td>Stops and removes the recipe from SenseSdk.</td>
</tr>
<tr>
<td>findRecipe</td>
<td>String</td>
<td>Finds and returns a recipe by name.</td>
</tr>
<tr>
<td>getAllRecipes</td>
<td></td>
<td>Returns all registered recipes.</td>
</tr>
</tbody></table>

<h2 id="triggerfireddelegate">TriggerFiredDelegate</h2>

<p>The TriggerFiredDelegate is a protocol that should be implemented by the class which will be notified when a trigger is fired.</p>
<pre><code class="highlight swift"><span class="kd">class</span> <span class="kt">MyClass</span> <span class="p">:</span> <span class="kt">TriggerFiredDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">onTriggerFired</span><span class="p">(</span><span class="nv">args</span><span class="p">:</span> <span class="kt">TriggerFiredArgs</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">NSLog</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">places</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> places fired on </span><span class="se">\(</span><span class="n">timestamp</span><span class="se">)</span><span class="s">, with a confidence level of: </span><span class="se">\(</span><span class="n">args</span><span class="o">.</span><span class="n">confidenceLevel</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<table><thead>
<tr>
<th>Response Arg</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>timestamp</td>
<td>NSDate</td>
<td>Time the trigger fired</td>
</tr>
<tr>
<td>recipe</td>
<td>Recipe</td>
<td>The registered recipe that triggered</td>
</tr>
<tr>
<td>places</td>
<td>[Place]</td>
<td>The list of places that were entered or exited</td>
</tr>
<tr>
<td>confidenceLevel</td>
<td>ConfidenceLevel</td>
<td>The confidence that the action actually occurred.</td>
</tr>
</tbody></table>

<h2 id="confidence-levels">Confidence Levels</h2>

<p>When a trigger is fired, it brings along one of three confidence levels.</p>

<ol>
<li>High</li>
<li>Medium</li>
<li>Low</li>
</ol>

<h1 id="thanks-for-using-sense360">Thanks for using Sense360</h1>

<h3 id="to-sign-up-for-a-developer-key,-click-the-green-link-on-the-left-side-of-this-page!"><em>To sign up for a developer key, click the green link on the left side of this page!</em></h3>

          
      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="Swift">Swift</a>
          </div>
      </div>
    </div>
  </body>
</html>
